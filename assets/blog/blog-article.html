<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Blog Article | Omaha Property Group</title>
  <meta name="description" content="Read the latest Omaha real estate insights, buyer and seller tips, and market updates.">
  <link rel="preconnect" href="https://lh3.googleusercontent.com" crossorigin>
  <style>
    :root {
      --bg:#0c1116; --surface:#ffffff; --ink:#0f1720; --muted:#667085; --line:#e8edf3; --soft:#f5f7fb;
      --brand:#4FA3D1; --brand-2:#1f6a91; --wrap:960px; --radius:14px;
    }
    body {
      margin:0; font-family:Inter, system-ui, sans-serif; color:var(--ink); background:#fff;
      -webkit-font-smoothing:antialiased;
    }
    a{color:var(--brand);text-decoration:none;} a:hover{color:var(--brand-2);}
    header, main { max-width:var(--wrap); margin:auto; padding:24px; }
    img.hero { width:100%; height:380px; object-fit:cover; border-radius:12px; margin-bottom:20px; }
    h1 { font-size:36px; margin:10px 0 6px; }
    .meta { color:var(--muted); font-size:14px; margin-bottom:20px; }
    article p, article ul { line-height:1.6; font-size:17px; }
    ul { padding-left:20px; }
    footer { text-align:center; color:var(--muted); font-size:14px; margin:40px 0 20px; }
    .cta-strip{margin:22px 0; padding:18px; border-left:6px solid var(--brand); background:var(--soft); border-radius:12px; display:flex; flex-wrap:wrap; gap:12px; align-items:center}
    .cta-strip a.cta-btn {
      display: inline-block;
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      color: #fff;
      background: var(--brand);
      text-decoration: none;
      font-weight: 600;
      transition: background 0.2s ease;
    }
    .cta-strip a.cta-btn:hover {
      background: var(--brand-2);
    }
  </style>
</head>
<body>
  <header>
    <a href="/blog.html" style="display:inline-block;margin-bottom:20px;">← Back to Blog</a>
    <img id="hero" class="hero" src="" alt="Blog cover image">
    <h1 id="title">Loading...</h1>
    <div id="meta" class="meta"></div>
  </header>

  <main>
    <article id="content"></article>
  </main>

  <footer>© <span id="year"></span> Omaha Property Group</footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const BLOG_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSKbZH8PCNmsSP2W2yvSDCuVS7jXDI7mo-SVHMq6XmiuOWvoNXeWCsGo_kGBQjTAg_Ffx_rMUfyz_ts/pub?gid=1016587363&single=true&output=csv";
    const slug = new URLSearchParams(window.location.search).get("slug");

    function toDirect(u){
      if(!u) return '';
      const id = (u.match(/[?&]id=([^&]+)/)||[])[1] || (u.match(/\/d\/([^\/]+)/)||[])[1];
      return id ? `https://lh3.googleusercontent.com/d/${id}=s1600` : u;
    }
    function parseCSV(t){
      const rows=[], row=[]; let i=0,inQ=false,cell='';
      while(i<t.length){ const ch=t[i];
        if(ch=='"'){ if(inQ && t[i+1]=='"'){ cell+='"'; i+=2; continue; } inQ=!inQ; i++; continue; }
        if(!inQ && ch==','){ row.push(cell); cell=''; i++; continue; }
        if(!inQ && (ch=='\n'||ch=='\r')){ if(ch=='\r'&&t[i+1]=='\n') i++; row.push(cell); rows.push(row.splice(0)); cell=''; i++; continue; }
        cell+=ch; i++;
      }
      row.push(cell); rows.push(row);
      return rows;
    }
    const key = h => String(h||'').toLowerCase().replace(/\s+/g,'');

    async function loadArticle(){
      const res = await fetch(BLOG_CSV);
      const csv = await res.text();
      const rows = parseCSV(csv);
      if(!rows.length) return null;
      const headers = rows[0].map(key);
      const data = rows.slice(1).map(r=>{
        const o={}; headers.forEach((h,i)=>o[h]=(r[i]||'').trim()); return o;
      });
      return data.find(p => (p.slug||'').trim() === slug);
    }

    (async()=>{
      const post = await loadArticle();
      const titleEl = document.getElementById("title");
      const metaEl = document.getElementById("meta");
      const contentEl = document.getElementById("content");
      const heroEl = document.getElementById("hero");

      if(!post){
        titleEl.textContent = "Post not found";
        metaEl.textContent = "";
        heroEl.style.display = "none";
        return;
      }

      titleEl.textContent = post.title || "Untitled Post";
      metaEl.textContent = `${new Date(post.date).toLocaleDateString()} • ${Math.max(1, Math.round((post.contenthtml||'').split(' ').length / 200))} min read`;
      if(post.coverurl) heroEl.src = toDirect(post.coverurl);
      else heroEl.style.display = "none";
      contentEl.innerHTML = post.contenthtml || "<p>No content available.</p>";

      // Add CTA strip inside content after the article content
      const ctaStrip = document.createElement('div');
      ctaStrip.className = 'cta-strip';
      ctaStrip.innerHTML = '<span>Want a custom plan for your price range and neighborhood?</span><a class="cta-btn" href="/index.html#contact">Talk with an agent today</a>';
      contentEl.after(ctaStrip);
    })();
  </script>
</body>
</html>