<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Omaha Real Estate Blog | Estee Real Estate Team | BHHS Ambassador Real Estate</title>
  <meta name="description" content="Omaha real estate insights, market updates, and neighborhood guides from the Estee Real Estate Team — part of BHHS Ambassador Real Estate." />
  <link rel="preconnect" href="https://images.unsplash.com" crossorigin>
  <link rel="preconnect" href="https://lh3.googleusercontent.com" crossorigin>

  <style>
    :root{
      --bg:#0c1116; --surface:#ffffff; --ink:#0f1720; --muted:#667085; --line:#e8edf3; --soft:#f5f7fb;
      --brand:#4FA3D1; --brand-2:#1f6a91; --ring:rgba(79,163,209,.28); --wrap:1200px; --radius:14px;
      --shadow:0 10px 30px rgba(16, 24, 40, .08); --shadow-hover:0 16px 44px rgba(16, 24, 40, .14);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased;font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--brand);text-decoration:none} a:hover{color:var(--brand-2)}
    .wrap{max-width:var(--wrap);margin:0 auto;padding:0 20px}

    /* Hero */
    .hero{color:#fff;background:linear-gradient(180deg, rgba(12,17,22,.66), rgba(12,17,22,.88)), url('https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=2400&auto=format&fit=crop') center/cover no-repeat}
    .hero-inner{padding:56px 0}
    .hero h1{font-weight:800;font-size:40px;line-height:1.08;margin:0 0 8px}
    .hero p{color:#cfe8f6;margin:0}

    main{background:#fff;border-top-left-radius:28px;border-top-right-radius:28px}
    section{padding:56px 0}
    .section-h{font-size:28px;margin:0 0 10px}
    .meta{color:var(--muted);font-size:14px}

    /* Controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 18px}
    .search{flex:1;min-width:220px;display:flex;align-items:center;background:#fff;border:1px solid var(--line);border-radius:999px;padding:8px 12px}
    .search input{border:0;outline:0;width:100%;font:inherit}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:6px 12px;color:#0f1720;cursor:pointer}
    .chip[aria-pressed="true"]{background:var(--brand);color:#fff;border-color:transparent}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(12,minmax(0,1fr));gap:22px}
    .col-4{grid-column:span 4}
    @media(max-width:960px){ .col-4{grid-column:span 6} }
    @media(max-width:640px){ .col-4{grid-column:span 12} }

    .card{background:#fff;border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:var(--shadow);transition:.25s ease transform,.25s ease box-shadow}
    .card:hover{transform:translateY(-3px);box-shadow:var(--shadow-hover)}
    .card img{width:100%;height:220px;object-fit:cover;display:block}
    .card-body{padding:14px}
    .pill{display:inline-block;background:#f5f7fb;border:1px solid #e4eef6;color:#0d4e6f;border-radius:999px;padding:4px 10px;font-size:12px;font-weight:700}
    .post-title{margin:8px 0 6px;font-size:18px;line-height:1.25}
    .post-meta{color:#667085;font-size:13px}
    .read-more{display:inline-block;margin-top:10px}

    /* Pager */
    .pager{display:flex;gap:10px;justify-content:center;margin-top:18px}
    .pager a{display:inline-block;border:1px solid var(--line);border-radius:8px;padding:8px 12px;background:#fff}

    footer{background:#0f1720;color:#b7c6d2}
    .foot{display:grid;grid-template-columns:1.2fr 1fr 1fr;gap:24px;padding:36px 0}
    .foot a{color:#cfe8f6}
    @media(max-width:960px){.foot{grid-template-columns:1fr}}

    @media(max-width:768px){
      .hero h1, .hero p { text-align:center; }
    }

    /* Ensure hero never overlays sticky header (so menu is clickable) */
    .hero{ position: relative; z-index: 0; }
    .hero::before{ pointer-events:none; }
  </style>

  <!-- Blog schema (empty scaffold; populate server-side if desired) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Blog",
    "name":"Omaha Real Estate Blog",
    "url":"https://esteerealestateteam.com/blog.html",
    "blogPost":[]
  }
  </script>
</head>
<body>

  <!-- Shared header include -->
  <div id="opg-header-placeholder"></div>
  <script>
    (function(){
      const mount = document.getElementById('opg-header-placeholder');
      fetch('./header.html', { cache:'no-cache' })
        .then(r=>r.text())
        .then(html=>{
          const tpl = document.createElement('template');
          tpl.innerHTML = html.trim();
          const frag = tpl.content.cloneNode(true);
          // Extract any scripts so we can execute them after insertion
          const scripts = Array.from(frag.querySelectorAll('script'));
          scripts.forEach(s => s.parentNode.removeChild(s));
          // Insert header markup
          mount.replaceWith(frag);
          // Execute header scripts (ensures mobile menu works)
          scripts.forEach(s => {
            const ns = document.createElement('script');
            if (s.src) { ns.src = s.src; if (s.defer) ns.defer = true; if (s.async) ns.async = true; }
            else { ns.textContent = s.textContent || ''; }
            document.body.appendChild(ns);
          });
          // Reserve space for sticky header so content isn't hidden and taps register
          requestAnimationFrame(()=>{
            const h = document.querySelector('header.site-header, .site-header, header.site');
            if (h) {
              document.body.classList.add('header-ready');
              document.body.style.paddingTop = h.offsetHeight + 'px';
            }
          });
          // Fallback: manually wire menu button like Residential (guards against browsers that block inline script exec)
          setTimeout(()=>{
            const btn = document.querySelector('.menu-btn');
            const drawer = document.querySelector('.drawer');
            if (btn && drawer && !btn._opgWired) {
              btn.addEventListener('click', ()=>{
                const open = drawer.classList.toggle('open');
                btn.setAttribute('aria-expanded', open ? 'true' : 'false');
              });
              drawer.querySelectorAll('a').forEach(a=>a.addEventListener('click', (e)=>{
                const href = a.getAttribute('href') || '';
                drawer.classList.remove('open');
                btn.setAttribute('aria-expanded','false');
                // Ensure navigation proceeds reliably on iOS Safari
                if (href && href.startsWith('/')) { e.preventDefault(); setTimeout(()=>{ location.href = href; }, 10); }
              }));
              btn._opgWired = true;
            }
          }, 0);
        })
        .catch(err=>console.warn('[ESTEE] header include failed', err));
    })();
  </script>

  <section class="hero">
    <div class="wrap hero-inner">
      <h1>Omaha Real Estate Blog</h1>
      <p>Market updates, neighborhood guides, buyer & seller tips — from a team that works Omaha every day.</p>
    </div>
  </section>

  <main>
    <section>
      <div class="wrap">
        <div class="controls">
          <div class="search" role="search">
            <input id="q" type="search" placeholder="Search posts (e.g., Aksarben, first‑time buyer, NNN)" inputmode="search" aria-label="Search blog posts" autocomplete="off">
          </div>
          <div class="chips" id="chips" role="group" aria-label="Filter by category">
            <button class="chip" data-cat="All" aria-pressed="true">All</button>
            <button class="chip" data-cat="Market">Market</button>
            <button class="chip" data-cat="Neighborhoods">Neighborhoods</button>
            <button class="chip" data-cat="Buyers">Buyers</button>
            <button class="chip" data-cat="Sellers">Sellers</button>
            <button class="chip" data-cat="Commercial">Commercial</button>
          </div>
        </div>

        <div id="blog-grid" class="grid" aria-live="polite"></div>
        <nav class="pager" id="pager" aria-label="Pagination"></nav>
      </div>
    </section>
  </main>

  <!-- Blog in-page modal fallback -->
  <div id="blog-modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(15,23,32,.55);z-index:1000">
    <div style="width:min(920px,92vw);max-height:86vh;overflow:auto;background:#fff;border:1px solid #e8edf3;border-radius:16px;box-shadow:0 24px 60px rgba(16,24,40,.22)">
      <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #e8edf3">
        <h3 id="bm-title" style="margin:0;font-size:20px;">Loading…</h3>
        <button id="bm-close" aria-label="Close" style="all:unset;cursor:pointer;font-size:22px;line-height:1;padding:4px 8px">×</button>
      </div>
      <div id="bm-body" style="padding:16px">
        <img id="bm-img" alt="" style="width:100%;height:360px;object-fit:cover;border-radius:10px" loading="lazy" decoding="async">
        <p id="bm-excerpt" style="margin:12px 0 0;color:#364152"></p>
        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
          <a id="bm-read" href="#" class="cta" style="display:inline-block;background:#4FA3D1;color:#fff;border-radius:999px;padding:10px 16px;font-weight:700">Open full post</a>
          <a href="/index.html#contact" class="badge" style="border:1px solid #d7e6f3;border-radius:999px;padding:8px 12px;color:#0f1720">Talk to an agent</a>
        </div>
      </div>
    </div>
  </div>

  <div id="opg-footer-placeholder"></div>

  <script>
    // OPG footer include with duplicate removal guard
    (function(){
      const mount = document.getElementById('opg-footer-placeholder');
      // Prevent duplicate footer injection
      if (document.getElementById('opg-footer-injected')) return;
      fetch('./footer.html', { cache:'no-cache' })
        .then(r=>r.text())
        .then(html=>{
          // Remove any existing injected footer (precaution)
          const existing = document.getElementById('opg-footer-injected');
          if (existing) existing.remove();
          // Mark the injected footer for future guards
          const wrapper = document.createElement('div');
          wrapper.id = 'opg-footer-injected';
          wrapper.innerHTML = html;
          mount.replaceWith(wrapper);
        })
        .catch(err=>console.warn('[ESTEE] footer include failed', err));
    })();
  </script>

  <script>
    // ===== Blog engine: fetch posts from Google Sheet (published CSV) =====
    const BLOG_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSKbZH8PCNmsSP2W2yvSDCuVS7jXDI7mo-SVHMq6XmiuOWvoNXeWCsGo_kGBQjTAg_Ffx_rMUfyz_ts/pub?gid=1016587363&single=true&output=csv";

    const PAGE_SIZE = 9;
    let state = { q:"", cat:"All", page:1 };
    let POST_LIST = [];

    const grid  = document.getElementById('blog-grid');
    const pager = document.getElementById('pager');
    const q     = document.getElementById('q');

    // Helpers
    function toDirect(u){
      if(!u) return '';
      const id = (u.match(/[?&]id=([^&]+)/)||[])[1] || (u.match(/\/d\/([^\/]+)/)||[])[1];
      return id ? `https://lh3.googleusercontent.com/d/${id}=s1600` : u;
    }
    function parseCSV(t){
      const rows=[], row=[]; let i=0,inQ=false,cell='';
      while(i<t.length){ const ch=t[i];
        if(ch=='"'){ if(inQ && t[i+1]=='"'){ cell+='"'; i+=2; continue; } inQ=!inQ; i++; continue; }
        if(!inQ && ch==','){ row.push(cell); cell=''; i++; continue; }
        if(!inQ && (ch=='\n'||ch=='\r')){ if(ch=='\r'&&t[i+1]=='\n') i++; row.push(cell); rows.push(row.splice(0)); cell=''; i++; continue; }
        cell+=ch; i++;
      }
      row.push(cell); rows.push(row);
      return rows;
    }
    const key = h => String(h||'').toLowerCase().replace(/\s+/g,'');
    function toObj(headers, arr){ const o={}; headers.forEach((h,i)=>o[h]=(arr[i]||'').trim()); return o; }
    function estMinutes(html){
      if(!html) return '';
      const text = html.replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim();
      const words = text ? text.split(' ').length : 0;
      return Math.max(1, Math.round(words/220));
    }

    async function loadPosts(){
      const res = await fetch(BLOG_CSV, { cache:'no-cache' });
      const csv = await res.text();
      const rows = parseCSV(csv);
      if(!rows.length) return [];
      const headers = rows[0].map(key);
      const data = rows.slice(1).map(r=>toObj(headers,r));

      // Updated filter to only include posts explicitly published, with title and coverurl
      const list = data
        .filter(p =>
          p.published && p.published.toLowerCase() === 'yes' &&
          p.title && p.coverurl
        )
        .map(p => ({
          id: p.id || '',
          slug: p.slug || '',
          title: p.title || '',
          cat: p.category || p.cat || '',
          date: p.date || '',
          minutes: p.readmins || estMinutes(p.contenthtml),
          href: `./assets/blog/blog-article.html?slug=${encodeURIComponent(p.slug||'')}`,
          img: toDirect(p.coverurl),
          excerpt: p.excerpt || '',
          content: ''
        }));
      return list;
    }

    function render(){
      const qlc = state.q.trim().toLowerCase();
      const filtered = POST_LIST.filter(p => {
        const catOk = state.cat === 'All' || p.cat === state.cat || !state.cat;
        if(!catOk) return false;
        if(!qlc) return true;
        return [p.title,p.excerpt,p.cat].join(' ').toLowerCase().includes(qlc);
      });

      const total = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      state.page = Math.min(state.page, total);
      const start = (state.page-1)*PAGE_SIZE;
      const pageItems = filtered.slice(start, start+PAGE_SIZE);

      grid.innerHTML = pageItems.map(p => `
        <article class="col-4 card">
          <a href="${p.href}">
            <img src="${p.img}" loading="lazy" decoding="async" width="1200" height="720" alt="${p.title}">
          </a>
          <div class="card-body">
            ${p.cat ? `<div class="pill">${p.cat}</div>` : ''}
            <h3 class="post-title"><a href="${p.href}">${p.title}</a></h3>
            <div class="post-meta">${p.date ? new Date(p.date).toLocaleDateString() : ''}${p.minutes?` • ${p.minutes} min read`:''}</div>
            <p class="meta" style="margin-top:6px">${p.excerpt||''}</p>
            <a class="read-more" href="${p.href}">Read more →</a>
          </div>
        </article>
      `).join('');

      pager.innerHTML = Array.from({length: total}, (_,i)=>i+1).map(n => `
        <a href="#" ${n===state.page?'style="background:#f5f7fb"':''} data-n="${n}" aria-label="Go to page ${n}">${n}</a>
      `).join('');
    }

    // Modal support (kept; used only if a post provides inline content)
    const blogModal   = document.getElementById('blog-modal');
    const bmTitle     = document.getElementById('bm-title');
    const bmBody      = document.getElementById('bm-body');
    const bmImg       = document.getElementById('bm-img');
    const bmExcerpt   = document.getElementById('bm-excerpt');
    const bmRead      = document.getElementById('bm-read');
    const bmClose     = document.getElementById('bm-close');
    function renderFullPost(post){
      bmTitle.textContent = post.title || 'Post';
      if(post.img){ bmImg.src = post.img; bmImg.alt = post.title || ''; bmImg.style.display='block'; }
      else { bmImg.removeAttribute('src'); bmImg.style.display='none'; }
      if(post.content){
        bmExcerpt.style.display='none';
        const existing = bmBody.querySelector('.bm-article'); if(existing) existing.remove();
        const wrap = document.createElement('div'); wrap.className='bm-article'; wrap.innerHTML = post.content; bmBody.appendChild(wrap);
        bmRead.style.display='none';
      } else {
        bmExcerpt.style.display='block'; bmExcerpt.textContent = post.excerpt || '';
        bmRead.style.display = post.href ? 'inline-block' : 'none';
      }
      blogModal.style.display='flex';
    }
    function closeModal(){ blogModal.style.display='none'; }
    bmClose.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });
    blogModal.addEventListener('click', (e)=>{ if(e.target===blogModal) closeModal(); });

    document.getElementById('chips').addEventListener('click', e=>{
      const b = e.target.closest('.chip'); if(!b) return;
      document.querySelectorAll('.chip').forEach(x=>x.setAttribute('aria-pressed','false'));
      b.setAttribute('aria-pressed','true'); state.cat = b.dataset.cat; state.page=1; render();
    });
    q.addEventListener('input', ()=>{ state.q = q.value; state.page=1; render(); });
    pager.addEventListener('click', e=>{
      const a = e.target.closest('a'); if(!a) return; e.preventDefault(); state.page = Number(a.dataset.n||1); render();
    });

    // Load CSV then render
    (async function(){
      try{
        POST_LIST = await loadPosts();
      }catch(err){ console.warn('[OPG] Blog CSV load failed, falling back to empty list', err); POST_LIST = []; }
      render();
    })();
  </script>
</body>
</html>